/*
HTTP Host: static.ak.fbcdn.net
Generated: June 7th 2010 11:50:49 AM PDT
Machine: 10.16.140.102
Locale: nu_ll
Path: js/5zeuc0td20gs0kg4.pkg.js
*/

((location=='about:blank'&&(window.parent.eval_global||window.parent.eval))||(window.eval_global||window.eval))("if (window.CavalryLogger) { CavalryLogger.start_js([\"js\\\/5zeuc0td20gs0kg4.pkg.js\"]); }\n\nfunction AjaxPipeTransport(b,a){b=new URI(b).addQueryData(a).addQueryData({ajaxpipe:1});this.request=new AsyncRequest().setURI(b).setPreBootloadHandler(this._preBootloadHandler.bind(this)).setInitialHandler(this._onInitialResponse.bind(this)).setHandler(this._onResponse.bind(this)).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true).setOption('useIframeTransport',true);this.arbiter=new Arbiter();AjaxPipeTransport._current_request=this.request;}copy_properties(AjaxPipeTransport.prototype,{send:function(){this.request.send();return this;},_preBootloadFirstResponse:function(a){return false;},_fireDomContentCallback:function(){this.arbiter.inform('ajaxpipe\/domcontent_callback',true,Arbiter.BEHAVIOR_STATE);},_fireOnloadCallback:function(){this.arbiter.inform('ajaxpipe\/onload_callback',true,Arbiter.BEHAVIOR_STATE);},_preBootloadHandler:function(a){if(a.getPayload().redirect||this.request!=AjaxPipeTransport._current_request)return false;var b=false;if(a.is_first){b=this._preBootloadFirstResponse(a);this.pipe=new BigPipe(this.arbiter,a.payload.num_phases,this.request.cavalry,a.payload.roadrunner_enabled,true,this._fireDomContentCallback.bind(this),this._fireOnloadCallback.bind(this),'ajaxpipe\/domcontent_callback','ajaxpipe\/onload_callback');this.canvas_id=a.payload.canvas_id?a.payload.canvas_id:'content';AjaxPipeTransport.clearCanvas(this.canvas_id);}return b;},_redirect:function(a){return false;},_versionCheck:function(a){return true;},_onInitialResponse:function(b){var a=b.getPayload();if(this.request!=AjaxPipeTransport._current_request)return false;if(!a)return true;if(this._redirect(a)||!this._versionCheck(a))return false;return true;},_processFirstPayload:function(a){if(ge(a.canvas_id))CSS.setClass(a.canvas_id,a.canvas_class);},_onResponse:function(b){var a=b.payload;if(this.request!=AjaxPipeTransport._current_request)return AsyncRequest.suppressOnloadToken;if(b.is_first){this._processFirstPayload(a);a.provides.push('uipage_onload');}if(!b.is_last||b.is_first)this.pipe.onPageletArrive(a);if(b.is_last){AjaxPipeTransport.restoreCanvas(this.canvas_id);this.request.cavalry&&this.request.cavalry.setTimeStamp('t_html');}return AsyncRequest.suppressOnloadToken;},setFinallyHandler:function(a){this.request.setFinallyHandler(a);return this;},setErrorHandler:function(a){this.request.setErrorHandler(a);return this;},abort:function(){this.request.abort();if(AjaxPipeTransport._current_request==this.request)AjaxPipeTransport._current_request=null;return this;}});copy_properties(AjaxPipeTransport,{clearCanvas:function(a){var b=ge(a);if(b){b.style.height='1234px';DOM.empty(b);}DOMScroll.scrollTo(new Vector2(0,0,'document'),false);},restoreCanvas:function(a){var b=ge(a);if(b&&b.style.height=='1234px')b.style.height='';},getCurrentRequest:function(){return AjaxPipeTransport._current_request;},setCurrentRequest:function(a){AjaxPipeTransport._current_request=a;},isActiveOnPage:function(b){var a=new RegExp(env_get('ajaxpipe_inactive_page_regex')||null);return !a.test(URI(b).getPath());}});\n_PERSISTENT_BACKENDS={localstorage:LocalStorage};function LocalStorage(){this._store=window.localStorage;}LocalStorage.available=function(){return window.localStorage?true:false;};copy_properties(LocalStorage.prototype,{keys:function(){var b=[];for(var a=0;a<this._store.length;a++)b.push(this._store.key(a));return b;},get:function(a){return this._store.getItem(a);},set:function(a,b){this._store.setItem(a,b);},remove:function(a){this._store.removeItem(a);},clear:function(){this._store.clear();}});function CacheStorage(d,b){this._key_prefix=b||'_cs_';this._magic_prefix='_@_';if(d=='AUTO')for(var c in _PERSISTENT_BACKENDS){var a=_PERSISTENT_BACKENDS[c];if(a.available()){d=c;break;}}if(d)if(!_PERSISTENT_BACKENDS[d]){this._backend=null;}else this._backend=new _PERSISTENT_BACKENDS[d]();this._memcache={};}copy_properties(CacheStorage.prototype,{keys:function(){var d=[];if(this._backend){var a=this._backend.keys();for(var b=0;b<a.length;b++)if(a[b].substr(0,this._key_prefix.length)==this._key_prefix)d.push(a[b].substr(this._key_prefix.length));return d;}for(var c in this._memcache)d.push(c);return d;},set:function(b,a){this._memcache[b]=a;if(this._backend){if(typeof a=='string'){a=this._magic_prefix+a;}else a=JSON.encode(a);this._backend.set(this._key_prefix+b,a);}},get:function(b,c){if(this._memcache[b]!==undefined)return this._memcache[b];var d=undefined;if(this._backend){var d=this._backend.get(this._key_prefix+b);if(d!==null){if(d.substr(0,this._magic_prefix.length)==this._magic_prefix){d=d.substr(this._magic_prefix.length);}else d=JSON.decode(d);this._memcache[b]=d;}else d=undefined;}if(d===undefined&&c!==undefined){d=c;this._memcache[b]=d;if(this._backend){if(typeof d=='string'){var a=this._magic_prefix+d;}else var a=JSON.encode(d);this._backend.set(this._key_prefix+b,a);}}return d;},remove:function(a){delete this._memcache[a];if(this._backend)this._backend.remove(this._key_prefix+a);}});\nvar Configurable={getOption:function(a){if(typeof(this.option[a])=='undefined')return null;return this.option[a];},setOption:function(a,b){if(!(typeof(this.option[a])=='undefined'))this.option[a]=b;return this;},getOptions:function(){return this.option;}};\nfunction Nectar(){}copy_properties(Nectar,{linkHandler:function(c,a){var b=Nectar.getNectarParams();b.ia=1;var e=a.href;if(!e){e=URI.getRequestURI().toString();b.err=1;}b.url=e;var d='\/ajax\/nectar.php'+'?'+URI.implodeQuery({nctr:b})+'&';new AsyncSignal(d,{}).send();return c;},getNectarParams:function(){var a={};copy_properties(a,Nectar.extraData.get_query_data());return a;},extraData:function(){var a={};var b=[];return {set_item:function(c,e,d){var f=a[c];if(f===undefined){if(d)b.push(c);f=[];a[c]=f;}return f.push(e);},get_item:function(c){return a[c]||[];},get_query_data:function(){var c,f,d,e={};for(c=0;c<b.length;c++){d=b[c];f=a[d];if(f)e[d]=f.join(',');}if('pts' in a)e.num_pts=a.pts.length;a=[];b=[];return e;}};}()});\nvar PhotostreamConstants={ShowPhoto:'photostream\/showPhoto'};\nfunction NectarPhotosLog(){}copy_properties(NectarPhotosLog,{PHOTOS_BUF_LEN:20,showPhotoHandler:function(f,a){if(a.flush)NectarPhotosLog.flushLog();var b=a.node;var e=a.pid;var c=a.owner_id;var d=Nectar.extraData.get_item('pts');if(e!==undefined){if(d.length==0)Nectar.extraData.set_item('url',b.href,false);Nectar.extraData.set_item('pts',c+':'+e,true);}d=Nectar.extraData.get_item('pts');if(d.length>=NectarPhotosLog.PHOTOS_BUF_LEN)NectarPhotosLog.flushLog();return false;},flushLog:function(){var a=Nectar.extraData.get_item('pts');if(a.length>0){var b=Nectar.extraData.get_item('url')[0];Nectar.linkHandler(false,{href:b});}return false;}});onloadRegister(function(){Arbiter.subscribe(PhotostreamConstants.ShowPhoto,NectarPhotosLog.showPhotoHandler);});onbeforeunloadRegister(function(){NectarPhotosLog.flushLog();},false);\nfunction PageCache(a,b){if(this===window)return new PageCache(a,b);this._MAX_PAGE_NUM=typeof a=='undefined'?5:a;this._MAX_TTL=typeof b=='undefined'?600000:b;this._storage=new CacheStorage();}copy_properties(PageCache.prototype,{_normalizeURI:function(a){a=new URI(a);if(a.getPath()=='\/')a.setPath('\/home.php');return a.getUnqualifiedURI().setFragment('').removeQueryData('ref').toString();},addPage:function(c,b){c=this._normalizeURI(c);var a=this._storage.get(c,{});a.normalized_uri=new URI(c);copy_properties(a,b);a.accessTime=a.genTime=(new Date()).getTime();this._clearCache();},updatePage:function(c,a){c=this._normalizeURI(c);var b=this._storage.get(c);if(typeof b==='undefined')return;copy_properties(b,a);this._storage.set(c,b);},isPageInCache:function(b){var a=this._storage.get(this._normalizeURI(b));return (typeof a!=='undefined');},invalidatePage:function(a){a=this._normalizeURI(a);this._storage.remove(a);},getPage:function(b){this._clearCache();b=this._normalizeURI(b);var a=this._storage.get(b);if(typeof a==='undefined')return null;a.accessTime=(new Date()).getTime();return a;},_clearCache:function(){var b=(new Date()).getTime();var d=null;var f=0;var a=this._storage.keys();for(var c=0;c<a.length;c++){var h=a[c];var e=this._storage.get(h);var g=e.ttl||this._MAX_TTL;if(e.genTime<b-g){this._storage.remove(h);continue;}if(!d||this._storage.get(d).accessTime>e.accessTime)d=h;f++;}if(f>this._MAX_PAGE_NUM&&d)this._storage.remove(d);}});\nvar Quickling=window.Quickling||{isActive:function(){return Quickling._is_active||false;},isFeatureEnabled:function(a){return Quickling._capabilities&&Quickling._capabilities[a];},init:function(c,b,a){if(Quickling._is_initialized)return;copy_properties(Quickling,{_is_initialized:true,_is_active:true,_session_length:b,_capabilities:a,_is_in_transition:false,_title_interval:false,_ie_cache_title:'',_cache_hit:false,_version:c});Quickling._instrumentTimeoutFunc('setInterval');Quickling._instrumentTimeoutFunc('setTimeout');PageTransitions.registerHandler(Quickling._transitionHandler,1);if(Quickling.isFeatureEnabled('page_cache')){Quickling._cache=new PageCache();Quickling._invalidate_msgs=[];Arbiter.subscribe(\"pre_page_transition\",Quickling._onPrePageTransition);Arbiter.subscribe(Arbiter.NEW_NOTIFICATIONS,Quickling._onNotifications);Arbiter.subscribe(AsyncRequest.REPLAYABLE_AJAX,Quickling._onReplayableAjax);Arbiter.subscribe(Arbiter.PAGECACHE_INVALIDATE,Quickling._onCacheInvalidates);}},_onPrePageTransition:function(b,a){if(Quickling.isFeatureEnabled('page_cache')&&(page=Quickling._cache.getPage(a.from))&&!page.incremental_updates){invoke_callbacks(page.onpagecache);page.refresh_pagelets.forEach(function(c){var d=Quickling._getPageletById(c);d&&d.refresh(true);});page.incremental_updates=AsyncRequest.stashBundledRequest();}},_onNotifications:function(b,a){Quickling._cache=new PageCache();Quickling._invalidate_msgs=[];},_onCacheInvalidates:function(c,b){if(Quickling.isFeatureEnabled('page_cache')&&b&&b.length){for(var a=0;a<b.length;a++)if(parseInt(b[a])===0){if(Quickling._is_in_transition&&!Quickling.isFeatureEnabled('flush_cache_in_transition'))break;if(Quickling._cache.isPageInCache(PageTransitions.getMostRecentURI())&&!Quickling.isFeatureEnabled('flush_cache_in_page_write'))break;Quickling._cache=new PageCache();Quickling._invalidate_msgs=[];return;}Quickling._invalidate_msgs=Quickling._invalidate_msgs.concat(b);}},_refresh_pagelets:function(){if(is_empty(window.__listeners))return;for(var a=0;a<Quickling._invalidate_msgs.length;a++){var b=Quickling._invalidate_msgs[a];if(b in window.__listeners)window.__listeners[b].forEach(function(c){c.refresh();});}},registerPageCacheHook:function(a,c){if(!Quickling._is_initialized||!Quickling._is_active||Quickling._is_in_transition||!Quickling.isFeatureEnabled('page_cache'))return;var b=PageTransitions.getMostRecentURI();var e=Quickling._cache.getPage(b);if(e){if(c)for(var d=0;d<e.replays.length;d++)if(e.replays[d][0]==c){e.replays.splice(d,1);d--;}e.replays.push([c,a]);}},_onReplayableAjax:function(c,b){if((PageTransitions.getNextURI().toString()!=PageTransitions.getMostRecentURI().toString()))return;if(Quickling._is_in_transition)return;var a=Quickling._whitelist_regex;if(!a)a=Quickling._whitelist_regex=new RegExp(env_get('pagecache_whitelist_regex'));if(a.test(URI(b.getURI()).getPath()))return;Quickling.registerPageCacheHook(bind(b,b.replayResponse),b._replayKey);},_startQuicklingTransition:function(){Quickling._is_in_transition=true;window.channelManager&&window.channelManager.setActionRequest(true);},_stopQuicklingTransition:function(){(function(){Quickling._is_in_transition=false;}).defer();},isCacheHit:function(){return Quickling._cache_hit;},goHashOrGoHere:function(d){var c=URI.getRequestURI();var b=c.getFragment();if(b.startsWith('\/')){var a=b;}else var a=d;setTimeout(function(){PageTransitions.go(a,true);},0);},isPageActive:function(d){if(d=='#')return false;d=new URI(d);if(d.getDomain()&&d.getDomain()!=URI().getDomain())return false;var b=Quickling.isPageActive.regex;if(!b)b=Quickling.isPageActive.regex=new RegExp(env_get('quickling_inactive_page_regex'));var c=d.getPath();var a=d.getQueryData();if(a)c+='?'+URI.implodeQuery(a);if(b.test(c))return false;return true;},_getPageletById:function(a){return window.__UIControllerRegistry&&window.__UIControllerRegistry[a];},_setHTML:function(a,b){if(ua.ie()<=6){a.innerHTML=b;}else DOM.setContent(a,HTML(b).setDeferred(true));},_transitionHandler:function(h){AjaxPipeTransport.setCurrentRequest(null);if(Quickling._isTimeToRefresh())return false;if(!Quickling.isPageActive(h))return false;removeHook('onafterloadhooks');removeHook('onloadhooks');_runHooks('onleavehooks');window.ExitTime=(new Date()).getTime();Arbiter.inform('onload\/exit',true);Quickling._startQuicklingTransition();$('content').style.visibility=\"visible\";var e;if(Quickling.isFeatureEnabled('page_cache')&&(e=Quickling._cache.getPage(h))){var d=null;var f=(+new Date());var g=null;var a=new Arbiter();a.registerCallback(function(){if(AjaxPipeTransport.getCurrentRequest()!==d)return;if(d)if(d.cavalry){var i=null;if(g)i=g-f;d.cavalry.setTimeStamp('t_domcontent',null,null,i);d.cavalry.setTimeStamp('t_hooks',null,null,i);d.cavalry.setTimeStamp('t_layout',null,null,i);d.cavalry.setTimeStamp('t_onload',null,null,i);}Quickling._cache_hit=true;invoke_callbacks(e.onafterload);invoke_callbacks(e.onafterpagecache);Quickling._cache_hit=false;Quickling._stopQuicklingTransition();},['pagecache_update','pagecache_dom']);d=AsyncRequest.setBundledRequestProperties({stashedRequests:e.incremental_updates,callback:function(){if(d&&d.cavalry)d.cavalry&&d.cavalry.setTimeStamp('t_html');a.inform('pagecache_update',true,Arbiter.BEHAVIOR_EVENT);},onInitialResponse:function(j){var i=j.getPayload();if(i.redirect&&i.force){go_or_replace(window.location,i.redirect,true);return false;}else return true;},extra_data:{uri:e.normalized_uri.getQualifiedURI().toString(),version:Quickling._version},start_immediately:true});var c=$('content');c.style.visibility=\"hidden\";AjaxPipeTransport.setCurrentRequest(d);AjaxPipeTransport.clearCanvas('content');Bootloader.loadResources(e.css.concat(e.js),null,true);Quickling._changePageTitle(e.title);Quickling._replaceSyndicationLinks(e.syndication_links||[]);var b=e.body_class||'';CSS.setClass(document.body,b);e.html=e.html.replace(\/<span class=[\"']?muffin_tracking_pixel_start['\"]?><\\\/span>.*?<span class=[\"']?muffin_tracking_pixel_end['\"]?><\\\/span>\/ig,'');Quickling._setHTML(c,e.html);if(c&&c.style.height=='1234px')c.style.height='';PageTransitions.transitionComplete();Quickling._cache_hit=true;invoke_callbacks(e.onload);Quickling._cache_hit=false;Quickling._refresh_pagelets();e.replays.forEach(function(i){i[1]();});PageTransitions.restoreScrollPosition();e.refresh_pagelets.forEach(function(i){var j=document.getElementById(i);if(j)j.innerHTML='';});setTimeout(function(){$('content').style.visibility=\"visible\";g=(+new Date());a.inform('tti_pagecache',true,Arbiter.BEHAVIOR_EVENT);},20);a.inform('pagecache_dom',true,Arbiter.BEHAVIOR_EVENT);}else new QuickPipeTransport(h).send();return true;},_changePageTitle:function(a){a=a||'Facebook';document.title=a;if(ua.ie()){Quickling._ie_cache_title=a;if(!Quickling._title_interval)Quickling._title_interval=window.setInterval(function(){var b=Quickling._ie_cache_title;var c=document.title;if(b!=c)document.title=b;},5000,false);}},_replaceSyndicationLinks:function(d){var c=document.getElementsByTagName('link');for(var b=0;b<c.length;++b){if(c[b].rel!='alternate')continue;DOM.remove(c[b]);}if(d.length){var a=DOM.find(document,'head');a&&DOM.appendContent(a,HTML(d[0]));}},cacheResponse:function(c,a){var b=c.payload;Quickling._cache.addPage(PageTransitions.getNextURI(),{title:b.title,syndication:b.syndication||[],body_class:b.body_class,html:b.content.content,js:b.js||[],css:b.css||[],onload:b.onload||[],onafterload:b.onafterload||[],refresh_pagelets:b.refresh_pagelets||[],onpagecache:b.onpagecache||[],onafterpagecache:b.onafterpagecache||[],ttl:b.page_cache_ttl,replays:[]});if(a){invoke_callbacks(b.onload);onafterloadRegister(function(){invoke_callbacks(b.onafterload);});}},cacheAndExecResponse:function(c,d){var a=PageTransitions.getNextURI();var b=Quickling._cache.getPage(a);if(b){if(c.html)b.html=c.html;b.js=b.js.concat(c.js||[]);b.css=b.css.concat(c.css||[]);b.onload=b.onload.concat(c.onload||[]);b.onafterload=b.onafterload.concat(c.onafterload||[]);b.onpagecache=b.onpagecache.concat(c.onpagecache||[]);b.onafterpagecache=b.onafterpagecache.concat(c.onafterpagecache||[]);b.refresh_pagelets=b.refresh_pagelets.concat(c.refresh_pagelets||[]);}if(!d){invoke_callbacks(c.onload);onafterloadRegister(function(){invoke_callbacks(c.onafterload);});}},_isTimeToRefresh:function(){Quickling._load_count=(Quickling._load_count||0)+1;return Quickling._load_count>=Quickling._session_length;},_instrumentTimeoutFunc:function(a){window[a+'_native']=(function(c){var b=function b(e,d){return c(e,d);};return b;})(window[a]);window[a]=function _setTimeout(d,c,b){var e=window[a+'_native'](d,c);if(c>0)onunloadRegister(function(){clearInterval(e);},b);return e;};}};function QuickPipeTransport(b){var a={version:Quickling._version};this.parent.construct(this,b,{quickling:a});}QuickPipeTransport.extend('AjaxPipeTransport');copy_properties(QuickPipeTransport.prototype,{_preBootloadFirstResponse:function(b){var a=b.getPayload();if(Quickling.isFeatureEnabled('page_cache')&&a.page_cache_ttl)Quickling.cacheResponse(b);return true;},_fireDomContentCallback:function(){this.request.cavalry&&this.request.cavalry.setTimeStamp('t_domcontent');Quickling._stopQuicklingTransition();PageTransitions.transitionComplete();this.parent._fireDomContentCallback();},_fireOnloadCallback:function(){if(this.request.cavalry){this.request.cavalry.setTimeStamp('t_hooks');this.request.cavalry.setTimeStamp('t_layout');this.request.cavalry.setTimeStamp('t_onload');}this.parent._fireOnloadCallback();},_redirect:function(a){if(a.redirect){if(a.force||!Quickling.isPageActive(a.redirect)){go_or_replace(window.location,URI(a.redirect).removeQueryData(['quickling','ajaxpipe']),true);}else PageTransitions.go(a.redirect,true);return true;}else return false;},_versionCheck:function(a){if(a.version!=Quickling._version){go_or_replace(window.location,URI(a.uri).removeQueryData(['quickling','ajaxpipe']),true);return false;}else return true;},_processFirstPayload:function(b){Quickling._changePageTitle(b.title);Quickling._replaceSyndicationLinks(b.syndication||[]);var a=b.body_class||'';CSS.setClass(document.body,a);if(b.hasOnbeforeshow)$('content').style.visibility='hidden';}});function onpagecacheRegister(a,b){b=(b===undefined?'':String(b));Quickling.registerPageCacheHook(a,b);}\nfunction Task(a,b){copy_properties(this,{task:a,option:{synchronous:!!b},status:Task.WAITING,result:null,queue:null});}copy_properties(Task,{WAITING:0,READY:1,RUNNING:2,DONE:3,ERROR:4});copy_properties(Task.prototype,Configurable);copy_properties(Task.prototype,{run:function(){this.status=Task.RUNNING;try{var result=this.task();}catch(a){this.status=Task.ERROR;a._task=this;throw a;}if(this.getOption('synchronous'))this.didComplete(result);},didComplete:function(a){this.result=a;this.status=Task.DONE;if(this.queue)this.queue.didCompleteTask(this);return this;}});function TaskQueue(){copy_properties(this,{queue:[],executingTasks:0,executionDepth:0,option:{synchronous:true,concurrency:2}});}copy_properties(TaskQueue.prototype,Configurable);copy_properties(TaskQueue.prototype,{addTask:function(a){this.queue.push(a);a.queue=this;return a;},didCompleteTask:function(a){this.executingTasks--;this.reapQueue();if(!this.executionDepth)this.start();},runTask:function(b){this.executingTasks++;if(this.getOption('synchronous')){try{b.run();}catch(a){this.didCompleteTask();}}else setTimeout(bind(b,'run'),10);},reapQueue:function(){var c;var a,b;for(a=0,b=this.queue.length;a<b;a++){c=this.queue[a].status;if(c!=Task.DONE&&c!=Task.ERROR)break;}if(a)this.queue=this.queue.slice(a);},start:function(){this.executionDepth++;while(this.executingTasks<this.getOption('concurrency')){for(var a=0,b=this.queue.length;a<b;a++)if(this.queue[a].status==Task.READY){this.runTask(this.queue[a]);break;}if(a==b)break;}this.executionDepth--;},ready:function(c){c=c||1;for(var a=0,b=this.queue.length;a<b;a++)if(this.queue[a].status==Task.WAITING){this.queue[a].status=Task.READY;if(!(--c))break;}this.start();}});\nvar Photolike={bindKeys:function(b){var a=b||'photoinfo';KeyEventController.registerKey('L',function(){var c=DOM.scry(ge(a),\"button[name='like']\")[0];if(c)c.click();});KeyEventController.registerKey('U',function(){var c=DOM.scry(ge(a),\"button[name='unlike']\")[0];if(c)c.click();});}};\nfunction PhotoTag(a,b,d,c){copy_properties(this,{centerPoint:new Vector2(a\/100,b\/100),photoOwnerId:d,photoId:c});copy_properties(this,{taggeeName:'',taggeeId:null,taggeeEmail:'',_saved:false,_pendingAsync:false});}copy_properties(PhotoTag,{SYNCING_ENDPOINT:'\/ajax\/photo_tagging_ajax.php',MAX_TAGS_PER_PHOTO:50,_tagList:{},_photoKey:function(a,b){return a+':'+b;},tagsForPhoto:function(a,c){var b=PhotoTag._photoKey(a,c);return PhotoTag._tagList[b]||[];},clearTagsForPhoto:function(a,c){var b=PhotoTag._photoKey(a,c);PhotoTag._tagList[b]=[];}});copy_properties(PhotoTag.prototype,{setTaggeeEmail:function(a){if(this.saved){return this;}else this.taggeeEmail=a;return this;},setTaggeeName:function(a){if(this.saved){return this;}else this.taggeeName=a;return this;},setTaggeeId:function(a){if(!(this.saved))this.taggeeId=a;return this;},absoluteCenter:function(b,a){return this.centerPoint.mul(b,a);},submit:function(b){if(!this.taggeeName&&!this.taggeeId){return;}else if(this._saved){return;}else if(this._pendingAsync){return;}else if(PhotoTag.MAX_TAGS_PER_PHOTO<=PhotoTag.tagsForPhoto(this.photoId,this.photoOwnerId).length)return;b=b||bagofholding;var a={pid:this.photoId,id:this.photoOwnerId,subject:this.taggeeId,name:this.taggeeName,email:this.taggeeEmail,action:'add',x:this.centerPoint.x*100,y:this.centerPoint.y*100};this._pendingAsync=true;new AsyncRequest().setURI(PhotoTag.SYNCING_ENDPOINT).setData(a).setHandler(bind(this,this._submitHandler,b)).setErrorHandler(bind(this,this._submitHandler,b)).setFinallyHandler(bind(this,function(){this._pendingAsync=false;})).send();},remove:function(c,a){if(!this.taggeeName&&!this.taggeeId){return;}else if(this._pendingAsync){return;}else if(!this._saved){this._removeLocal();return c(this,{});}c=c||bagofholding;var b={pid:this.photoId,id:this.photoOwnerId,subject:this.taggeeId,name:this.taggeeName,action:a||'remove'};this._pendingAsync=true;new AsyncRequest().setURI(PhotoTag.SYNCING_ENDPOINT).setData(b).setHandler(bind(this,this._removeHandler,c)).setFinallyHandler(bind(this,function(){this._pendingAsync=false;})).send();return false;},_removeLocal:function(){var c=PhotoTag._photoKey(this.photoId,this.photoOwnerId);var d=PhotoTag._tagList[c]||[];for(var a=0,b=d.length;a<b;a++)if(d[a]==this){d.splice(a,1);break;}},setLocalSave:function(){var b=PhotoTag._photoKey(this.photoId,this.photoOwnerId);var a=PhotoTag._tagList[b]=PhotoTag._tagList[b]||[];PhotoTag._tagList[b][a.length]=this;return this;},setSaved:function(){this._saved=true;return this.setLocalSave();},getText:function(){return this.taggeeName||this.taggeeEmail;},getTaggeeId:function(){return this.taggeeId;},_submitHandler:function(a,d){var b=d.getError();var c=d.getPayload();if(b){ErrorDialog.showAsyncError(d);if(!c['tag_success'])return;}this.setSaved();this.taggeeName=c.taggeeName;this.taggeeId=c.taggeeId;a(this,c);},_removeHandler:function(a,b){this._removeLocal();(a||bagofholding)(this,b.getPayload());}});\nfunction PhotoTagBoxController(b,a){Event.listen(b,{mouseover:function(c){var e=DOM.findParentByClass(c.getTarget(),'phototag_name');if(!e)return;var d=$(e.id.replace('tag_name','tag_box'));if(CSS.hasClass(d,'tag_box_unplaced'))Bootloader.loadComponents('photo-tag-box-positioning',function(){LegacyPhotoTagPositioner.position($('myphoto'),a);});CSS.removeClass(d,'hidden_elem');},mouseout:function(c){$$('#photo_container span.tag_outer').each(function(d){CSS.addClass(d,'hidden_elem');});}});}\n\nif (window.Bootloader) { Bootloader.done([\"js\\\/5zeuc0td20gs0kg4.pkg.js\"]); }")