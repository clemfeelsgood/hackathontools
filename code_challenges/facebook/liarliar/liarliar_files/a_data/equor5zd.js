/*
HTTP Host: static.ak.fbcdn.net
Generated: June 1st 2010 9:14:59 AM PDT
Machine: 10.16.140.102
Locale: nu_ll
Path: js/3vjlajh0v36s4wsc.pkg.js
*/

((location=='about:blank'&&(window.parent.eval_global||window.parent.eval))||(window.eval_global||window.eval))("if (window.CavalryLogger) { CavalryLogger.start_js([\"js\\\/3vjlajh0v36s4wsc.pkg.js\"]); }\n\nvar TypeaheadUtil=(function(){var c=\/[ ]+\/g,d=\/[^ ]+\/g,a=\/[^\\w ]\/g,b=\/[-~_\\u2010\\u2011\\u2012\\u2013\\u2014\\u2015]+\/g;var e=new RegExp('(\\\\'+['\/','.','*','+','?','|','(',')','[',']','{','}','\\\\'].join('|\\\\')+')','g');var f={\"\\u0430\":'a',\"\\u00e0\":'a',\"\\u00e1\":'a',\"\\u00e2\":'a',\"\\u00e3\":'a',\"\\u00e4\":'a',\"\\u00e5\":'a',\"\\u0431\":'b',\"\\u0446\":'c',\"\\u00e7\":'c',\"\\u0434\":'d',\"\\u00f0\":'d',\"\\u044d\":'e',\"\\u0435\":'e',\"\\u00e8\":'e',\"\\u00e9\":'e',\"\\u00ea\":'e',\"\\u00eb\":'e',\"\\u0444\":'f',\"\\u0433\":'g',\"\\u0445\":'h',\"\\u0438\":'i',\"\\u00ec\":'i',\"\\u00ed\":'i',\"\\u00ee\":'i',\"\\u00ef\":'i',\"\\u0439\":'j',\"\\u043a\":'k',\"\\u043b\":'l',\"\\u043c\":'m',\"\\u043d\":'n',\"\\u00f1\":'n',\"\\u043e\":'o',\"\\u00f8\":'o',\"\\u00f6\":'o',\"\\u00f5\":'o',\"\\u00f4\":'o',\"\\u00f3\":'o',\"\\u00f2\":'o',\"\\u043f\":'p',\"\\u0440\":'r',\"\\u0441\":'s',\"\\u0442\":'t',\"\\u0443\":'u',\"\\u044e\":'u',\"\\u00fc\":'u',\"\\u00fb\":'u',\"\\u00fa\":'u',\"\\u00f9\":'u',\"\\u0432\":'v',\"\\u044b\":'y',\"\\u00ff\":'y',\"\\u00fd\":'y',\"\\u0437\":'z',\"\\u00e6\":'ae',\"\\u0153\":'oe',\"\\u0446\":'ts',\"\\u0447\":'ch',\"\\u0448\":'sh',\"\\u044f\":'ya'};var g=function(l){return l?l.replace(a,' '):'';};var h=function(l){return l?l.replace(e,'\\\\$1'):'';};var i=function(o){o=(''+o).toLowerCase();var n='',l='';for(var m=o.length;m--;){l=o.charAt(m);n=(f[l]||l)+n;}return n.replace(c,' ');};var j=function(l){return l?l.replace(b,' '):'';};var k=function(p){p=p.toLowerCase();var m=i(p),l=g(m),o=j(m);if(p!=m)p+=' '+m;if(p!=l)p+=' '+l;if(p!=o)p+=' '+o;var q=[],r={},n=d.exec(p);while(n){n=n[0];if(!r[n]){q.push(n);r[n]=true;}n=d.exec(p);}return q;};return {escape:h,flatten:i,tokenize:k};})();\nfunction DataSource(a){copy_properties(this,a);}DataSource.mixin('Arbiter',{events:['activity','query','respond'],maxResults:10,queryData:{},queryEndpoint:'',bootstrapData:{},bootstrapEndpoint:'',indexedFields:['text','tokens'],init:function(){this.init=bagofholding;this.numResults=this.maxResults;this.dirty();},dirty:function(){this.value=this.flatValue='';this.bootstrapped=false;this.data={};this.localCache={};this.queryCache={};},bootstrap:function(){if(this.bootstrapped)return;this.fetch(this.bootstrapEndpoint,this.bootstrapData);this.bootstrapped=true;},query:function(d){this.inform('beforeQuery',{});var a=TypeaheadUtil.flatten(d),c=this.buildUids(a),b=this.respond(d,c).filter(function(e){return e.type!='calltoaction';});this.value=d;this.flatValue=a;this.inform('query',{value:d,results:b});if(!a||!this.queryEndpoint||a in this.queryCache||b.length>=this.numResults)return false;this.inform('queryEndpoint',{value:d});this.fetch(this.queryEndpoint,this.getQueryData(d,c),d,a);return true;},getQueryData:function(c,b){var a=copy_properties({value:c},this.queryData||{});b=b||[];if(b.length)a.existing_ids=b.join(',');return a;},setQueryData:function(a,b){if(b)this.queryData={};copy_properties(this.queryData,a);return this;},respond:function(d,c,a){var b=this.buildData(c);this.inform('respond',{value:d,results:b,isAsync:a});return b;},fetch:function(c,b,e,d){if(!c)return;var a=new AsyncRequest().setURI(c).setData(b).setMethod('GET').setReadOnly(true).setHandler(function(f){this.fetchHandler(f,e,d);}.bind(this));if(!Env.is_dev)a.setErrorHandler(bagofholding);a.send();this.inform('activity',{activity:true,value:e});},fetchHandler:function(b,c,a){this.addEntries(b.getPayload().entries,c,a);this.inform('fetchComplete',{response:b,value:c});this.respond(c,this.buildUids(a),true);this.inform('activity',{activity:false,value:c});},addEntries:function(b,e,c){var d=this.processEntries(arrayize(b),e),a=this.buildUids(c,d);if(e){this.queryCache[c]=a;}else this.fillCache(a);},processEntries:function(a,b){return a.map(function(d,c){var e=(d.uid=d.uid+'');this.data[e]=d;d.index=c;d.query=b;return e;},this);},getEntry:function(a){return this.data[a]||null;},fillCache:function(b){var a=this.localCache;b.each(function(g){var d=this.data[g];if(!d)return;var f=this.getTokens(d);for(var c=0,e=f.length;c<e;++c){var h=f[c];if(!a[h])a[h]=[];a[h].push(g);}},this);},getTokens:function(e){if(e.preparedTokens)return e.preparedTokens;var f=[],b=this.indexedFields;for(var d=0,c=b.length;d<c;++d){var a=e[b[d]];if(a)f.push(a.join?a.join(' '):a);}return (e.preparedTokens=TypeaheadUtil.tokenize(f.join(' ')));},buildUids:function(h,b){if(!h)return b||[];var e=function(i,j){return this.data[i].index-this.data[j].index;}.bind(this);var f=TypeaheadUtil.tokenize(h),a=this.buildCacheResults(f,this.localCache).sort(e),d=this.buildQueryResults(h,f),c=a.concat(d,b||[]),g={};return c.filter(function(i){if(i in g)return false;return (g[i]=true);});},buildData:function(e){var c=[],b=this.numResults;for(var a=0;a<e.length&&b;++a){var d=e[a];c.push(this.data[d]);b--;}return c;},findQueryCache:function(d){var b=0,a=null;for(var c in this.queryCache)if(d.indexOf(c)==0&&c.length>b){b=c.length;a=c;}return this.queryCache[a]||[];},buildQueryResults:function(c,b){var a=this.findQueryCache(c);if(c in this.queryCache)return a;return a.filter(function(h){var i=this.getTokens(this.data[h]),f=i.length,d;for(var e=0;e<b.length;++e){for(d=0;d<i.length;++d){var g=new RegExp('^'+TypeaheadUtil.escape(b[e]));if(g.test(i[d]))break;}if(d==f)return false;}return true;},this);},buildCacheResults:function(n,b){var k=n.length,i=[],h={},g={};for(var e=0;e<k;++e){var m=n[e],l=new RegExp('^'+TypeaheadUtil.escape(m));for(var j in b)if(!(j in h)&&l.test(j)){h[j]=true;var d=b[j];for(var f=0,c=d.length;f<c;++f){var o=d[f];if(!(o in g)){i.push(o);g[o]=0;}g[o]|=(1<<e);}}}var a=(1<<k)-1;return i.filter(function(p){return !!(p&&g[p]==a);});}});\nfunction SearchDataSource(a){this.parent.construct(this,a);}SearchDataSource.extend('DataSource');SearchDataSource.prototype={minResults:3,maxResults:8,init:function(){this.parent.init();this.updateMaxResults();Event.listen(window,'resize',this.updateMaxResults.bind(this));},updateMaxResults:function(){var a=window.innerHeight||document.documentElement.clientHeight,b=Math.ceil(2+((a-370)\/56));this.numResults=Math.max(this.minResults,Math.min(this.maxResults,b));this.respond(this.value,this.buildUids(this.flatValue));}};\nfunction TypeaheadCore(a,b){this.element=$(a);copy_properties(this,b);}TypeaheadCore.mixin('Arbiter',{events:['blur','focus','reset','unselect'],keepFocused:true,resetOnSelect:false,setValueOnSelect:false,queryTimeout:250,init:function(a,d,c){this.init=bagofholding;this.data=a;this.view=d;var b=c.parentNode;this.root=CSS.getStyle(b,'position')!='static'?b:c;this.wrap=DOM.find(c,'div.wrap');this.hiddenInput=DOM.find(c,'input.hiddenInput');this.selectedText=this.getValue();this.initializeSubscriptions();this.initializeEvents();},initializeSubscriptions:function(){this.view.subscribe('select',function(a,b){this.select(b.selected.text,b.selected.uid);}.bind(this));this.data.subscribe('respond',function(b,a){if(a.value==undefined&&!this.selectedText){this.checkValue(true);}else if(a.value==this.getValue())this.view.render(a.value,a.results,a.isAsync);}.bind(this));this.data.subscribe('activity',function(b,a){this.fetching=a.activity;if(!this.fetching&&this.nextQuery)this.performQuery();}.bind(this));},initializeEvents:function(){var a=this.checkEvent.bind(this);Event.listen(this.element,{blur:a,focus:a,keyup:a});var b=ua.firefox()?'keypress':'keydown';Event.listen(this.element,b,a);this.keypress=this.keydown;if(ua.firefox())this.element.addEventListener('text',a,true);},select:function(a,b){if(this.resetOnSelect){this.reset();}else if(!this.keepFocused)this.element.blur();this.view.reset();if(this.setValueOnSelect){this.setValue(a);this.setHiddenValue(b);CSS.addClass(this.wrap,'selected');}this.selectedText=a;},unselect:function(){if(this.setValueOnSelect)CSS.removeClass(this.wrap,'selected');this.setHiddenValue();this.selectedText=null;this.inform('unselect',this);},reset:function(){this.unselect();this.setValue();this.view.reset();this.element.focus();if(!this.keepFocused)(function(){this.element.blur();}).bind(this).defer();this.inform('reset');},checkEvent:function(event){if(!event)return;var a=event.type;if(a=='text')a='keyup';this[a]&&this[a](event);this.checkValue.bind(this,false).defer();},blur:function(event){this.view.hide();CSS.removeClass(this.root,'uiTypeaheadFocused');this.inform('blur',{element:this.element});},focus:function(event){if(!this.selectedText&&this.getValue())this.view.show();CSS.addClass(this.root,'uiTypeaheadFocused');this.inform('focus',{element:this.element});},keyup:function(event){if(!this.getValue())this.view.reset();},keydown:function(event){if(!this.view.visible)return;switch(Event.getKeyCode(event)){case KEYS.UP:this.view.prev();event.kill();break;case KEYS.DOWN:this.view.next();event.kill();break;case KEYS.TAB:var a=event.getModifiers().shift?'prev':'next';this.view[a]();event.kill();break;case KEYS.RETURN:if(this.view.select()!==false)event.kill();break;case KEYS.ESC:this.reset();break;}},getElement:function(){return this.element;},setValue:function(a){this.value=a||'';this.element.value=this.value;},setHiddenValue:function(a){this.hiddenInput.value=a||'';},getValue:function(){return this.element.getValue();},getHiddenValue:function(){return this.hiddenInput.value||'';},checkValue:function(b){var d=this.getValue();if(!b&&d==this.value)return;if(this.selectedText&&this.selectedText!=d)this.unselect();var c=(+new Date()),a=c-this.time;this.time=c;this.nextQuery=this.value=d;if(!this.fetching||a>this.queryTimeout)this.performQuery();},performQuery:function(){this.data.query(this.nextQuery);this.nextQuery=null;}});\nfunction SearchTypeaheadCore(a,b){this.parent.construct(this,a,b);}SearchTypeaheadCore.extend('TypeaheadCore');SearchTypeaheadCore.prototype={init:function(a,f,e){this.parent.init(a,f,e);var b=DOM.getNearest(e,'form'),d=this.reset.bind(this);if(b){var c=DOM.find(b,'input.search_ref_input');if(c.value=='search_preload')c.value='search_loaded';Event.listen(b,'submit',function(){d.defer();},Event.Priority.URGENT);}}};\nfunction SearchTypeaheadRecorder(a){this.init(a);this._reset();}SearchTypeaheadRecorder.prototype={init:function(c){var a=c.getCore(),b=c.getData(),d=c.getView();a.subscribe('blur',function(e,f){if(this.sessionStart){this.recordValuePerSessionStat('session_sec',new Date()\/1000-this.sessionStart\/1000);this.sessionStart=null;}if(this.query)this.recordValuePerSessionStat('query',this.query);this.submit();}.bind(this));a.subscribe('focus',function(e,f){this.sessionStart=+new Date();this.recordOdsCountedStat('session_count');}.bind(this));a.subscribe('keydown',function(e,f){if(f.key==KEYS.BACKSPACE)this.recordCountedStat('backspace_count');}.bind(this));b.subscribe('activity',function(e,f){if(f.activity){this.activityStartTime=+new Date();}else if(f.activity===false&&this.activityStartTime){this.recordAveragedStat(f.value?'search_endpoint_ms_from_js':'first_endpoint_ms_from_js',new Date()-this.activityStartTime);this.activityStartTime=null;}}.bind(this));b.subscribe('beforeQuery',function(e,f){this.queryStart=+new Date();this.respondCount=0;}.bind(this));b.subscribe('respond',function(e,f){var h=new Date()-this.queryStart;var g=null;if(this.respondCount===0){this.recordAveragedStat('show_something_ms',h);g=this.respondCount+1;}if(this.respondCount===1||f.results.length==10){this.recordAveragedStat('show_full_ms',h);g=null;}this.respondCount=g;this.shownResultIds=f.results.map(function(i){return i.uid;}).filter(function(i){return i!='search';});}.bind(this));b.subscribe('query',function(e,f){this.query=f.value;this.recordCountedStat('num_search_queries');this.recordAveragedStat('num_served_from_js_cache',f.results.length);}.bind(this));b.subscribe('queryEndpoint',function(e,f){this.recordCountedStat('num_search_ajax_requests');this.recordAveragedStat('endpoint_query_length',f.value.length);}.bind(this));d.subscribe('select',function(e,g){this.recordValuePerSessionStat('selected_with_mouse',g.clicked?1:0);if(g.selected.type==='calltoaction'&&g.selected.path.indexOf('\/search\/')>=0){this.recordOdsCountedStat('selected_search');}else{this.recordOdsCountedStat('selected_'+g.selected.type);this.recordValuePerSessionStats({selected_position:g.index,selected_type:g.selected.type,selected_name_length:g.selected.text.length,selected_id:g.selected.uid,selected_degree:g.selected.query?2:1});}if(this.shownResultIds)for(var f=0;f<this.shownResultIds.length;++f)this.recordValuePerSessionStat('candidate_result_id_'+f,this.shownResultIds[f]);}.bind(this));this._data=b;},recordAveragedStat:function(c,d){if(this._averagedStats[c]){var b=this._averagedStats[c][0];var a=this._averagedStats[c][1];this._averagedStats[c]=[(b*a\/(a+1))+(d\/(a+1)),a+1];}else this._averagedStats[c]=[d,1];return this;},recordValuePerSessionStats:function(b){for(var a in b)this.recordValuePerSessionStat(a,b[a]);return this;},recordValuePerSessionStat:function(a,b){if(this._valuePerSessionStats[a])throw \"Already have value for \"+a;this._valuePerSessionStats[a]=b;},recordCountedStat:function(a){if(!this._countedStats[a])this._countedStats[a]=0;++this._countedStats[a];return this;},recordOdsCountedStat:function(a){this.recordValuePerSessionStat(a,1);},_dataToSubmit:function(){var a={};for(var b in this._averagedStats)a[b]=this._averagedStats[b][0];return merge(a,this._valuePerSessionStats,this._countedStats);},_reset:function(){this._averagedStats={};this._valuePerSessionStats={};this._countedStats={};var a={sid:Math.random()};this._data.setQueryData(a);this.recordValuePerSessionStats(a);},submit:function(){var a=this._dataToSubmit();if(count(a)>0)new AsyncRequest().setURI('\/ajax\/typeahead\/record_metrics.php').setMethod('POST').setData({stats:a}).send();this._reset();}};\nvar TypeaheadRenderers={basic:function(b,d){var f=b.markup||htmlize(b.text),e=b.subtext,c=b.icon,a='';if(b.type)a=' class=\"'+b.type+'\"';return ['<li',a,'>',(c?'<img class=\"icon\" src=\"'+c+'\" alt=\"\"\/>':''),(f?'<span class=\"text\">'+f+'<\/span>':''),(e?'<span class=\"subtext\">'+e+'<\/span>':''),'<\/li>'];},compact:function(c,d){var g=c.markup||htmlize(c.text),e=c.photo,f=c.subtext,a=c.category,b='';if(c.type)b=' class=\"'+c.type+'\"';return ['<li',b,'>',(e?'<img src=\"'+e+'\" alt=\"\" \/>':''),(g?'<span class=\"text\">'+g+'<\/span>':''),'<div class=\"details\"><span class=\"detailsContents\">',(a?a:''),(f&&a?' &middot ':''),(f?f:''),'<\/span><\/div>','<\/li>'];},search:function(c,d){var h=c.markup||htmlize(c.text),f=c.photo,g=c.subtext,a=c.category,e=c.is_external,b='';if(c.type)b=' class=\"'+c.type+'\"';return ['<li',b,'>',(f?'<img src=\"'+f+'\" alt=\"\" \/>':''),(h?'<span class=\"text\">'+h+'<\/span>':''),(a?'<div class=\"category\"><span class=\"categoryContents\">'+a+(e?'<span class=\"externalArrow\"><\/span>':'')+'<\/span><\/div>':''),(g?'<div class=\"subtext\">'+g+'<\/div>':''),'<\/li>'];}};\nfunction TypeaheadView(a,b){this.element=$(a);copy_properties(this,b);}TypeaheadView.mixin('Arbiter',{events:['highlight','render','reset','select'],renderer:'basic',autoSelect:false,init:function(){this.init=bagofholding;this.initializeEvents();this.reset();},initializeEvents:function(){var a=this.checkEvent.bind(this);Event.listen(this.element,{mousedown:a,mouseover:a});},reset:function(){this.hide();this.index=-1;this.items=[];this.results=[];this.element.innerHTML='';this.inform('reset');},checkEvent:function(event){if(!event)return;var a=event.type;this[a]&&this[a](event);},getIndex:function(event){return this.items.indexOf(DOM.getNearest(event.getTarget(),'li'));},getSelection:function(){var a=this.items[this.index]||null;return this.visible?a:null;},mousedown:function(event){this.select(true);},mouseover:function(event){this.highlight(this.getIndex(event));},show:function(){if(!this.results.length)return;CSS.removeClass(this.element,'hidden_elem');this.visible=true;},hide:function(){CSS.addClass(this.element,'hidden_elem');this.visible=false;},render:function(g,d,e){if(!g||!d.length){this.reset();return;}var c=this.results[this.index],b=this.autoSelect?0:-1;this.results=d;this.element.innerHTML=this.buildMarkup(d);this.items=this.getItems();if(c&&e)for(var a=0,f=d.length;a<f;++a)if(c.uid==d[a].uid){b=a;break;}this.highlight(b,false);this.show();this.inform('render',d);},getItems:function(){return DOM.scry(this.element,'li');},buildMarkup:function(c){var b,a=['<ul>'];if(typeof this.renderer==\"function\"){b=this.renderer;}else b=TypeaheadRenderers[this.renderer];c.each(function(d,e){a=a.concat(b(d,e));},this);a.push('<\/ul>');return a.join('');},next:function(){this.highlight(this.index+1);},prev:function(){this.highlight(this.index-1);},highlight:function(a,b){this.selected&&CSS.removeClass(this.selected,'selected');a=Math.min(Math.max(-1,a),this.items.length-1);if(a>=0&&a<this.items.length){this.selected=this.items[a];CSS.addClass(this.selected,'selected');}this.index=a;if(b!==false)this.inform('highlight',{index:a,selected:this.results[a]});},select:function(a){var b=this.index,c=this.results[b];if(!c)return false;this.inform('select',{index:b,clicked:!!a,selected:c});}});\nfunction SearchTypeaheadView(a,b){this.parent.construct(this,a,b);}SearchTypeaheadView.extend('TypeaheadView');SearchTypeaheadView.prototype={render:function(e,c,d,a){var b='<span class=\"seeMoreTitle\">'+_tx(\"See More Results for {query}\",{query:htmlize(e)})+'<span class=\"seeMoreArrow\"><\/span><\/span><br \/>'+'<span class=\"seeMoreResultsCount\">'+(c.length==1?_tx(\"Displaying Top Result\"):_tx(\"Displaying Top {number} Results\",{number:c.length}))+'<\/span>';if(e&&c.length>0&&!a)c.push({uid:'search',text:e,type:'calltoaction',path:'\/search\/?init=quick&q='+encodeURIComponent(e),markup:b});return this.parent.render(e,c,d);},select:function(a){var b=this.results[this.index],c=b&&b.path;this.parent.select(a);if(!c)return false;if(c.indexOf('http:\/\/')!=0&&c.indexOf('https:\/\/')!=0)c=Env.www_base+c.substr(1);c+=(c.indexOf('?')>0?'&':'?')+'ref=ts';if(b.is_external){goURI(c,true);}else goURI(c);}};\n\nif (window.Bootloader) { Bootloader.done([\"js\\\/3vjlajh0v36s4wsc.pkg.js\"]); }")